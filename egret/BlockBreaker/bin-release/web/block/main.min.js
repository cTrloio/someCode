var Block=function(e){function t(t,i,s){void 0===t&&(t=GameFactory.BLOCK_GREEN),e.call(this),this.collisioned=GameFactory.BLOCK_TYPE_CLOSE,this.name=GameFactory.BLOCK_NAME_GREEN,i&&s?this._shape=GameFactory.createShape(i,s,t):this._shape=GameFactory.createShape(GameFactory.blockWidth,GameFactory.blockHeight,t),this.addChild(this._shape)}__extends(t,e);var i=(__define,t);i.prototype;return t}(egret.Sprite);egret.registerClass(Block,"Block");var Bullet=function(e){function t(){e.call(this),this.speedX=0,this.speedY=0,this.gravity=GameFactory.gravity,this.canLunch=!1,this._bullet=this.createBullet(),this.addChild(this._bullet)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createBullet=function(){var e=new egret.Shape;return e.graphics.lineStyle(1,0),e.graphics.beginFill(GameFactory.BULLET_1),e.graphics.drawRect(0,0,15,15),e.graphics.endFill(),e},t}(egret.Sprite);egret.registerClass(Bullet,"Bullet");var Collision=function(){function e(){}var t=(__define,e);t.prototype;return e.block=function(e,t,i){var s,r,o,h;s=i?e.x-(t.x+t.width/2):e.x+e.width/2-(t.x+t.width/2),r=e.y+e.height/2-(t.y+t.height/2),Math.abs(s)<e.width/2+t.width/2&&Math.abs(r)<e.height/2+t.height/2?(o=e.width/2+t.width/2-Math.abs(s),h=e.height/2+t.height/2-Math.abs(r),o>=h?r>0?(this.collisionSide="Top",t.y-=h):(this.collisionSide="Bottom",t.y+=h):s>0?(this.collisionSide="Left",t.x-=o):(this.collisionSide="Right",t.x+=o)):this.collisionSide="No collision"},e.collisionSide="",e}();egret.registerClass(Collision,"Collision");var GameFactory=function(){function e(){}var t=(__define,e);t.prototype;return e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.createBitmapByJsonName=function(e,t){var i=new egret.Bitmap,s=RES.getRes(e);return i.texture=s.getTexture(t),i},e.createShape=function(e,t,i){var s=new egret.Shape;return s.graphics.clear(),s.graphics.lineStyle(1,0),s.graphics.beginFill(i),s.graphics.drawRect(0,0,e,t),s.graphics.endFill(),s},e.clearShape=function(){var e=new egret.Shape;return e.graphics.clear(),e},e.randomColor=function(){var t=Math.floor(10*Math.random());switch(t){case 0:return e.BLOCK_BLUE;case 1:return e.BLOCK_ORANGE;default:return e.BLOCK_GREEN}},e.score=0,e.sceneWidth=480,e.sceneHeight=800,e.sceneTop=100,e.blockWidth=75,e.blockHeight=40,e.wallWidth=12,e.wallHeight=800,e.wallTopWidth=480,e.wallTopHeight=12,e.BLOCK_BLUE=4805973,e.BLOCK_ORANGE=16093498,e.BLOCK_GREEN=8235594,e.BLOCK_NAME_GREEN="normal",e.BLOCK_NAME_BLUE="blue",e.BLOCK_NAME_ORG="org",e.BLOCK_BLACK=2301741,e.SLIDER_1=7962301,e.SLIDER_2=4805973,e.SLIDER_3=16093498,e.BACKGROUND=9565079,e.BACKGROUND2=12698049,e.BULLET_1=16096862,e.bounce=15,e.gravity=5,e.BLOCK_TYPE_CLOSE="close",e.BLOCK_TYPE_OPEN="open",e.BLOCK_TYPE_OVER="over",e.slider_w=100,e.slider_h=30,e.block_Hnum=6,e.block_Vnum=5,e}();egret.registerClass(GameFactory,"GameFactory");var GameScene=function(e){function t(){e.call(this),this.blockArr=[],this.wallArr=[],this.starArr=[],this.resetNum=0,this.score=0,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageHd,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStageHd,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.addToStageHd=function(e){this.addObjectHd(),this.addEventHd()},s.addObjectHd=function(){for(var e=0;e<GameFactory.block_Vnum;e++)this.blockArr[e]=new Array(GameFactory.block_Hnum);for(var e=0;e<GameFactory.block_Vnum;e++)for(var t=0;t<GameFactory.block_Hnum;t++)this.blockArr[e][t]=new Block(GameFactory.randomColor());var i=GameFactory.createShape(GameFactory.sceneWidth,GameFactory.sceneHeight,GameFactory.BACKGROUND2);i.y=GameFactory.sceneTop,this.addChild(i),this.showScore=new egret.TextField,this.showScore.text=this.score+"",this.showScore.size=60,this.showScore.bold=!0,this.showScore.x=GameFactory.sceneWidth/2-this.showScore.width/2,this.showScore.y=20,this.addChild(this.showScore),this.createWall(),this.createBlock(),this.createSlider(),this.createBullet()},s.addEventHd=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHd,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterHd,this),this.once(egret.TouchEvent.TOUCH_TAP,this.init,this),this.resetSlider=new egret.Timer(15e3),this.resetSlider.addEventListener(egret.TimerEvent.TIMER,this.resetSliderHd,this)},s.init=function(e){this.bullet.canLunch=!0;var t=Math.atan2(e.stageY-this.slider.y,e.stageX-this.slider.x);this.bullet.speedX=Math.cos(t)*this.slider.bounce,this.bullet.speedY=Math.sin(t)*this.slider.bounce},s.enterHd=function(e){if(this.bullet.canLunch&&(this.bullet.x+=this.bullet.speedX,this.bullet.y+=this.bullet.speedY,this.par.emitterX=this.bullet.x+this.bullet.width/2,this.par.emitterY=this.bullet.y+this.bullet.height/2,this.collisionWall(),this.collisionSlider(),this.collisionBlock(),this.starHd(),this.bullet.y>800&&(GameFactory.score=this.score,this.dispatchEvent(new egret.Event("gameover"))),this.resetNum>=30&&this.bullet.y>500)){for(var t=0;t<this.blockArr.length;t++)for(var i=0;i<this.blockArr[t].length;i++)this.blockArr[t][i].alpha=1,this.blockArr[t][i].collisioned=GameFactory.BLOCK_TYPE_CLOSE;this.resetNum=0;for(var s=0;s<this.blockArr[0].length;s++)this.blockArr[4][s].collisioned=GameFactory.BLOCK_TYPE_OPEN}},s.starHd=function(){for(var e=0;e<this.starArr.length;e++)if(null!=this.starArr[e]){if(this.starArr[e].y+=GameFactory.gravity,this.starArr[e].y>1e3)return this.removeChild(this.starArr[e]),this.starArr[e]=null,void this.starArr.splice(e,1);Collision.block(this.starArr[e],this.slider),("Top"==Collision.collisionSide||"Bottom"==Collision.collisionSide||"Right"==Collision.collisionSide||"Left"==Collision.collisionSide)&&(this.starArr[e].name==GameFactory.BLOCK_NAME_BLUE?this.slider.changeSliderWidth(200):this.slider.changeSliderBounce(10),this.resetSlider.reset(),this.resetSlider.start(),this.removeChild(this.starArr[e]),this.starArr[e]=null,this.starArr.splice(e,1))}},s.dosomething=function(e,t){if(this.resetNum++,GameFactory.gravity>5?this.score+=2:this.score++,this.showScore.text=this.score+"",this.blockArr[e][t].alpha=0,this.blockArr[e][t].collisioned=GameFactory.BLOCK_TYPE_OVER,this.sarchColled(e,t),this.blockArr[e][t].name==GameFactory.BLOCK_NAME_BLUE){var i=this.createStar(GameFactory.BLOCK_NAME_BLUE,GameFactory.SLIDER_2,this.blockArr[e][t]);this.addChild(i),this.starArr.push(i)}if(this.blockArr[e][t].name==GameFactory.BLOCK_NAME_ORG){var i=this.createStar(GameFactory.BLOCK_NAME_ORG,GameFactory.SLIDER_3,this.blockArr[e][t]);this.addChild(i),this.starArr.push(i)}},s.collisionBlock=function(){for(var e=0;e<this.blockArr.length;e++)for(var t=0;t<this.blockArr[e].length;t++)"open"==this.blockArr[e][t].collisioned&&(Collision.block(this.blockArr[e][t],this.bullet),"Top"==Collision.collisionSide?(this.bullet.speedY=-this.bullet.speedY,this.dosomething(e,t)):"Bottom"==Collision.collisionSide?(this.bullet.speedY=-this.bullet.speedY,this.dosomething(e,t)):"Left"==Collision.collisionSide?(this.bullet.speedX=-this.bullet.speedX,this.dosomething(e,t)):"Right"==Collision.collisionSide&&(this.bullet.speedX=-this.bullet.speedX,this.dosomething(e,t)))},s.collisiionDo=function(e,t){Collision.block(e,t),"Top"==Collision.collisionSide?t.speedY=-t.speedY:"Bottom"==Collision.collisionSide?t.speedY=-t.speedY:"Left"==Collision.collisionSide?t.speedX=-t.speedX:"Right"==Collision.collisionSide&&(t.speedX=-t.speedX)},s.collisionWall=function(){for(var e=0;e<this.wallArr.length;e++)this.collisiionDo(this.wallArr[e],this.bullet)},s.collisionSlider=function(){Collision.block(this.slider,this.bullet,"slider");var e,t,i;("Top"==Collision.collisionSide||"Bottom"==Collision.collisionSide||"Right"==Collision.collisionSide||"Left"==Collision.collisionSide)&&(t=this.bullet.y-this.slider.y,i=this.bullet.x-this.slider.x,e=Math.atan2(t,i),this.bullet.speedX=Math.cos(e)*this.slider.bounce,this.bullet.speedY=Math.sin(e)*this.slider.bounce)},s.touchBeginHd=function(e){this.mouseX=e.stageX,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEndHd,this)},s.touchMoveHd=function(e){this.slider.x<GameFactory.wallWidth+this.slider.width/2&&(this.slider.x=GameFactory.wallWidth+this.slider.width/2),this.slider.x>GameFactory.sceneWidth-this.slider.width/2-GameFactory.wallWidth&&(this.slider.x=GameFactory.sceneWidth-this.slider.width/2-GameFactory.wallWidth),this.bullet.canLunch||(this.bullet.x=this.slider.x,this.par.emitterX=this.slider.x),this.slider.x+=e.stageX-this.mouseX,this.mouseX=e.stageX},s.touchEndHd=function(){this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMoveHd,this),this.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEndHd,this)},s.createBlock=function(){for(var e,t=GameFactory.block_Vnum,i=GameFactory.block_Hnum,s=0;t>s;s++)for(var r=0;i>r;r++){e=GameFactory.randomColor();var o=new Block(e);e==GameFactory.BLOCK_BLUE&&(o.name=GameFactory.BLOCK_NAME_BLUE),e==GameFactory.BLOCK_ORANGE&&(o.name=GameFactory.BLOCK_NAME_ORG),this.addChild(o),this.blockArr[s][r]=o,this.blockArr[s][r].x=r*o.width+GameFactory.wallWidth,this.blockArr[s][r].y=s*o.height+GameFactory.sceneTop}for(var h=0;h<this.blockArr[0].length;h++)this.blockArr[4][h].collisioned=GameFactory.BLOCK_TYPE_OPEN},s.createWall=function(){var e=new Block(GameFactory.BLOCK_BLACK,GameFactory.wallWidth,GameFactory.wallHeight),t=new Block(GameFactory.BLOCK_BLACK,GameFactory.wallWidth,GameFactory.wallHeight),i=new Block(GameFactory.BLOCK_BLACK,GameFactory.wallTopWidth,GameFactory.wallTopHeight);this.wallArr.push(e),this.wallArr.push(t),this.wallArr.push(i),t.x=GameFactory.sceneWidth-t.width;for(var s=0;s<this.wallArr.length;s++)this.addChild(this.wallArr[s]),this.wallArr[s].y=GameFactory.sceneTop-GameFactory.wallTopHeight},s.createSlider=function(){this.slider=new Slider,this.addChild(this.slider),this.slider.x=GameFactory.sceneWidth/2,this.slider.y=GameFactory.sceneHeight/8*7+this.slider.height/2},s.createBullet=function(){this.bullet=new Bullet,this.addChild(this.bullet),this.bullet.x=this.slider.x,this.bullet.y=this.slider.y-this.bullet.height,this.bullet.alpha=0;var e=RES.getRes("bullPng"),t=RES.getRes("bullJson");this.par=new particle.GravityParticleSystem(e,t),this.addChild(this.par),this.par.start(),this.par.emitterX=this.bullet.x,this.par.emitterY=this.bullet.y},s.createStar=function(e,t,i){var s=new Block(t,GameFactory.blockHeight,GameFactory.blockHeight);return s.x=i.x+i.width/4,s.y=i.y,s.name=e,s},s.resetSliderHd=function(){this.slider.resetSider(),this.resetSlider.reset(),this.resetSlider.stop()},s.sarchColled=function(e,t){for(var i=[[0,1],[1,0],[0,-1],[-1,0]],s=0,r=0,o=0;4>o;o++)s=e+i[o][0],r=t+i[o][1],s<this.blockArr.length&&r<this.blockArr[o].length&&s>=0&&r>=0&&this.blockArr[s][r].collisioned==GameFactory.BLOCK_TYPE_CLOSE&&(this.blockArr[s][r].collisioned=GameFactory.BLOCK_TYPE_OPEN)},s.removeStageHd=function(){this.wallArr=[],this.blockArr=[],this.removeChild(this.par),this.removeChild(this.slider),this.removeChild(this.bullet),this.removeChild(this.showScore),this.resetSlider.reset(),this.resetSlider.stop(),this.resetSlider.removeEventListener(egret.TimerEvent.TIMER,this.resetSliderHd,this),this.touchEnabled=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.enterHd,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBeginHd,this),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageHd,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeStageHd,this)},t}(egret.Sprite);egret.registerClass(GameScene,"GameScene");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.gameScene=null,this.txt=new egret.TextField,this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),s=i.prototype;return s.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(e){if("preload"==e.groupName){this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this);var t=GameFactory.createShape(GameFactory.sceneWidth,GameFactory.sceneHeight,GameFactory.BACKGROUND);this.addChild(t),this.txt.size=60,this.txt.bold=!0,this.txt.y=GameFactory.sceneHeight/8*1,this.txt.x=GameFactory.sceneWidth/2-this.txt.width/2,this.txt.textAlign=egret.HorizontalAlign.LEFT,this.addChild(this.txt),this.createGameScene()}},s.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},s.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},s.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},s.createGameScene=function(){this.txt.text=""+GameFactory.score,this.startBtn=this.createBtn("start",GameFactory.sceneHeight/8*2,this.startHd,200,80),this.addChild(this.startBtn),this.modelBtn=this.createBtn("pattern",GameFactory.sceneHeight/8*4,this.modelHd,200,80),this.addChild(this.modelBtn)},s.startHd=function(){this.removeHd(),this.gameScene=new GameScene,this.addChild(this.gameScene),this.gameScene.addEventListener("gameover",this.gameoverHd,this)},s.modelHd=function(){this.modelPanel=this.createPanel(),this.addChild(this.modelPanel)},s.easyHd=function(){GameFactory.bounce=15,GameFactory.gravity=5,GameFactory.slider_w=100,this.removeChild(this.modelPanel),this.removeHd(),this.createGameScene(),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startHd,this),this.modelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.modelHd,this)},s.hardHd=function(){GameFactory.bounce=20,GameFactory.gravity=10,GameFactory.slider_w=60,this.removeChild(this.modelPanel),this.removeHd(),this.createGameScene(),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startHd,this),this.modelBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.modelHd,this)},s.gameoverHd=function(){this.gameScene.removeEventListener("gameover",this.gameoverHd,this),this.removeChild(this.gameScene),this.gameScene=null,this.createGameScene()},s.removeHd=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startHd,this),this.modelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.modelHd,this),this.removeChild(this.startBtn),this.removeChild(this.modelBtn)},s.createBtn=function(e,t,i,s,r){var o=new egret.Sprite;o.graphics.beginFill(6327279),o.graphics.drawRoundRect(0,0,s,r,15),o.graphics.endFill(),o.x=GameFactory.sceneWidth/2-o.width/2,o.y=-80;var h=new egret.TextField;o.addChild(h),h.size=r/2,h.textColor=12698049,h.text=e,h.bold=!0,h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.x=o.width/2-h.width/2,h.y=o.height/2-h.height/2;var a=egret.Tween.get(o,{loop:!1});return a.to({y:t},1e3,egret.Ease.bounceOut),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,i,this),o},s.createPanel=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.startHd,this),this.modelBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.modelHd,this);var e=new egret.Sprite;e.graphics.beginFill(9565079),e.graphics.drawRoundRect(0,0,220,280,15),e.graphics.endFill(),e.x=130,e.y=200;var t=this.createBtn("easy",50,this.easyHd,150,60),i=this.createBtn("hard",150,this.hardHd,150,60);return e.addChild(t),e.addChild(i),t.x=e.width/2-t.width/4*3,i.x=e.width/2-i.width/4*3,e},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Slider=function(e){function t(){e.call(this),this.vx=0,this.vy=0,this.bounce=GameFactory.bounce,this._slider_w=GameFactory.slider_w,this._slider_h=GameFactory.slider_h,this._color=GameFactory.SLIDER_1,this.createSlider()}__extends(t,e);var i=(__define,t),s=i.prototype;return s.changeSliderWidth=function(e){this.removeChild(this._shape),this._slider_w=e,this.bounce=GameFactory.bounce,this._color=GameFactory.SLIDER_2,this.createSlider()},s.changeSliderBounce=function(e){this.removeChild(this._shape),this._slider_w=GameFactory.slider_w,this.bounce=e,this._color=GameFactory.SLIDER_3,this.createSlider()},s.resetSider=function(){this.removeChild(this._shape),this.bounce=GameFactory.bounce,this._slider_w=GameFactory.slider_w,this._slider_h=GameFactory.slider_h,this._color=GameFactory.SLIDER_1,this.createSlider()},s.createSlider=function(){this._shape=GameFactory.createShape(this._slider_w,this._slider_h,this._color),this.anchorOffsetX=this._shape.width/2,this.addChild(this._shape)},t}(egret.Sprite);egret.registerClass(Slider,"Slider");